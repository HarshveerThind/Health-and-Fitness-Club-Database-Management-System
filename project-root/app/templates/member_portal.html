{% extends "base.html" %}
{% block content %}
<h2>Member Portal</h2>

<section>
  <h3>Register new member</h3>
  <form method="post" action="{{ url_for('main.member_register_route') }}">
    <label>Name: <input type="text" name="name" required></label><br>
    <label>Email: <input type="email" name="email" required></label><br>
    <label>Date of birth: <input type="date" name="dob"></label><br>
    <label>Gender: <input type="text" name="gender"></label><br>
    <label>Phone: <input type="text" name="phone"></label><br>
    <button type="submit">Register</button>
  </form>
</section>

<hr>

<section>
  <h3>Select existing member</h3>
  <form method="get" action="{{ url_for('main.member_portal') }}">
    <label>Member:
      <select name="member_id">
        <option value="">-- choose --</option>
        {% for m in members %}
          <option value="{{ m.id }}" {% if m.id == selected_member_id %}selected{% endif %}>
            #{{ m.id }} - {{ m.name }} ({{ m.email }})
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Load</button>
  </form>
</section>

{% if dashboard_data %}
  {% set member = dashboard_data.member %}
  <hr>

  <section>
    <h3>Update profile & goal (Member #{{ member.id }})</h3>
    <form method="post" action="{{ url_for('main.member_profile_route') }}">
      <input type="hidden" name="member_id" value="{{ member.id }}">
      <label>Name: <input type="text" name="name" value="{{ member.name }}" required></label><br>
      <label>Gender: <input type="text" name="gender" value="{{ member.gender or '' }}"></label><br>
      <label>Phone: <input type="text" name="phone" value="{{ member.phone or '' }}"></label><br>

      <h4>New goal (optional)</h4>
      <label>Description: <input type="text" name="goal_description"></label><br>
      <label>Target weight (kg): <input type="number" step="0.1" name="target_weight"></label><br>

      <button type="submit">Save</button>
    </form>
  </section>

  <section>
    <h3>Add health metric</h3>
    <form method="post" action="{{ url_for('main.member_metric_route') }}">
      <input type="hidden" name="member_id" value="{{ member.id }}">
      <label>Height (cm): <input type="number" step="0.1" name="height_cm"></label><br>
      <label>Weight (kg): <input type="number" step="0.1" name="weight_kg"></label><br>
      <label>Heart rate (bpm): <input type="number" step="0.1" name="heart_rate_bpm"></label><br>
      <button type="submit">Add metric</button>
    </form>
  </section>

  <section>
    <h3>Dashboard</h3>
    <p><strong>Name:</strong> {{ member.name }}</p>
    <p><strong>Email:</strong> {{ member.email }}</p>

    <h4>Latest metric</h4>
    {% if dashboard_data.latest_metric %}
      <p>Height: {{ dashboard_data.latest_metric.height_cm or 'n/a' }} cm</p>
      <p>Weight: {{ dashboard_data.latest_metric.weight_kg or 'n/a' }} kg</p>
      <p>Heart rate: {{ dashboard_data.latest_metric.heart_rate_bpm or 'n/a' }} bpm</p>
    {% else %}
      <p>No health metrics yet.</p>
    {% endif %}

    <h4>Active goal</h4>
    {% if dashboard_data.active_goal %}
      <p>{{ dashboard_data.active_goal.description }}</p>
    {% else %}
      <p>No active goal.</p>
    {% endif %}

    <h4>Past classes</h4>
    <p>Total: {{ dashboard_data.past_classes_count }}</p>

    <h4>Upcoming PT sessions</h4>
    {% if dashboard_data.upcoming_pt_sessions %}
      <ul>
        {% for s in dashboard_data.upcoming_pt_sessions %}
          <li>{{ s.start_time }} with trainer #{{ s.trainer_id }} in room #{{ s.room_id }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No upcoming PT sessions.</p>
    {% endif %}
  </section>
{% endif %}
{% endblock %}
