{% extends "base.html" %}
{% block content %}
<h2>Trainer Portal</h2>

<section>
  <h3>Select trainer</h3>
  <form method="get" action="{{ url_for('main.trainer_portal') }}">
    <label>Trainer:
      <select name="trainer_id">
        <option value="">-- choose --</option>
        {% for t in trainers %}
          <option value="{{ t.id }}" {% if t.id == selected_trainer_id %}selected{% endif %}>
            #{{ t.id }} - {{ t.name }} ({{ t.email }})
          </option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Load</button>
  </form>
</section>

{% if selected_trainer_id and schedule_data %}
  <hr>
  <section>
    <h3>Set availability for {{ schedule_data.trainer.name }}</h3>
    <form method="post" action="{{ url_for('main.trainer_availability_route') }}">
      <input type="hidden" name="trainer_id" value="{{ schedule_data.trainer.id }}">
      <label>Start: <input type="datetime-local" name="start_time" required></label><br>
      <label>End: <input type="datetime-local" name="end_time" required></label><br>
      <button type="submit">Add slot</button>
    </form>

    <h4>Existing availability</h4>
    {% if schedule_data.availabilities %}
      <ul>
        {% for s in schedule_data.availabilities %}
          <li>{{ s.start_time }} - {{ s.end_time }}</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No availability slots yet.</p>
    {% endif %}
  </section>

  <section>
    <h3>Schedule</h3>

    <h4>Class sessions</h4>
    {% if schedule_data.classes %}
      <ul>
        {% for c in schedule_data.classes %}
          <li>{{ c.title }}: {{ c.start_time }} - {{ c.end_time }} (Room {{ c.room_id }})</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No class sessions.</p>
    {% endif %}

    <h4>PT sessions</h4>
    {% if schedule_data.pt_sessions %}
      <ul>
        {% for p in schedule_data.pt_sessions %}
          <li>Member #{{ p.member_id }}: {{ p.start_time }} - {{ p.end_time }} (Room {{ p.room_id }})</li>
        {% endfor %}
      </ul>
    {% else %}
      <p>No PT sessions.</p>
    {% endif %}
  </section>
{% endif %}

<hr>

<section>
  <h3>Member lookup</h3>
  <form method="get" action="{{ url_for('main.trainer_portal') }}">
    {% if selected_trainer_id %}
      <input type="hidden" name="trainer_id" value="{{ selected_trainer_id }}">
    {% endif %}
    <label>Name contains:
      <input type="text" name="search" value="{{ search_term or '' }}">
    </label>
    <button type="submit">Search</button>
  </form>

  {% if member_results %}
    <ul>
      {% for m in member_results %}
        <li>
          <strong>{{ m.name }}</strong> ({{ m.email }})
          <!-- For simplicity, we only show name/email here.
               Could expand with another query if you want last metric / goal inline. -->
        </li>
      {% endfor %}
    </ul>
  {% elif search_term %}
    <p>No members found for "{{ search_term }}".</p>
  {% endif %}
</section>
{% endblock %}
